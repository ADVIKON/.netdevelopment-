<ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '3px' }">
</ngx-loading>
<app-menu-list></app-menu-list>

<div class="container-fluid">
    <form [formGroup]="Regform" (ngSubmit)="onSubmitReg()">
        <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6 pull-left" style="padding: 0 0 0 0px;">
                    <label for="cCode" class="mb-2 mr-sm-2">Customer Code:</label>
                    <input type="text" id="cCode" style="text-transform: uppercase;" formControlName="cCode"
                        autocomplete="false" [(ngModel)]="Code" class="form-control mb-2 mr-sm-2" readonly />
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
                    <label for="countryName" class="mb-2 mr-sm-2">Country Name:</label>
                    <select name="countryName" formControlName="countryName"
                        [ngClass]="{ 'is-invalid': submitted && f.countryName.errors }" class="custom-select"
                        (change)="onChangeCountry($event.target.value)" id="countryName">
                        <option selected value="0"></option>
                        <option *ngFor="let cLst of CountryList" [value]="cLst.Id">{{cLst.DisplayName}}</option>
                    </select>
                    <div *ngIf="submitted && f.countryName.errors" class="invalid-feedback"></div>
                </div>
            </div>
            <div class="col-sm-4" style="padding: 0 0 0 0;">
                <div class="col-sm-5 pull-left" style="padding: 0 0 0 0px;">
                    <label for="stateName1" class="mb-2 mr-sm-2">State Name:</label>
                    <select name="stateName1" formControlName="stateName"
                        [ngClass]="{ 'is-invalid': submitted && f.stateName.errors }" class="custom-select"
                        (change)="onChangeState($event.target.value)" id="stateName1">
                        <option selected value="0"></option>
                        <option *ngFor="let stateLst of StateList" [value]="stateLst.Id">{{stateLst.DisplayName}}
                        </option>
                    </select>
                    <div *ngIf="submitted && f.stateName.errors" class="invalid-feedback"></div>
                   
                </div>
                <div class="col-sm-1 pull-left" style="padding: 0 0 0 2px;">
                    <label for="btnstateName" class="mb-2 mr-sm-2">&nbsp;</label>
                     <button id="btnstateName" class="btn btn-primary mb-2" (click)="openCommonModal(modalCommon,'State')">
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </button>
                </div>
                <div class="col-sm-1 pull-right" style="padding: 0 0 0 2px;">
                    <label for="btnstateName" class="mb-2 mr-sm-2">&nbsp;</label>
                     <button id="btnstateName" class="btn btn-primary mb-2" (click)="openCommonModal(modalCommon,'City')">
                        <i class="fa fa-bars" aria-hidden="true"></i>
                      </button>
                </div>
                <div class="col-sm-5 pull-right" style="padding: 0 0 0 5px;">
                    <label for="cityName" class="mb-2 mr-sm-2">City Name:</label>
                    <select name="cityName" formControlName="cityName"
                        [ngClass]="{ 'is-invalid': submitted && f.cityName.errors }" class="custom-select"
                        (change)="onChangeCity($event)" id="cityName">
                        <option selected value="0"></option>
                        <option *ngFor="let cityLst of CityList" [value]="cityLst.Id">{{cityLst.DisplayName}}</option>
                    </select>
                    <div *ngIf="submitted && f.cityName.errors" class="invalid-feedback"></div>
                </div>
                
            </div>
            <div class="col-sm-4">
                <div class="col-sm-6 pull-left" style="padding: 0 0 0 0;">

                    <label for="customerName" class="mb-2 mr-sm-2">Customer Name:</label>
                    <input type="text" formControlName="customerName" id="customerName"
                        [ngClass]="{ 'is-invalid': submitted && f.customerName.errors }" autocomplete="off"
                        class="form-control mb-2 mr-sm-2" [(ngModel)]="cName" />
                    <div *ngIf="submitted && f.customerName.errors" class="invalid-feedback"></div>
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
                    <label for="customerEmail" class="mb-2 mr-sm-2">Customer Email:</label>
                    <input type="text" formControlName="customerEmail" id="customerEmail"
                        [ngClass]="{ 'is-invalid': submitted && f.customerEmail.errors }" autocomplete="false"
                        class="form-control mb-2 mr-sm-2" />
                    <div *ngIf="submitted && f.customerEmail.errors" class="invalid-feedback">
                        <div *ngIf="f.customerEmail.errors.required"></div>
                        <div *ngIf="f.customerEmail.errors.email"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6 pull-left p-0">
                    <label for="totalToken" class="mb-2 mr-sm-2">Total Token's:</label>
                    <input type="number" formControlName="totalToken" id="totalToken" min=0 max=1000 value="0"
                        [ngClass]="{ 'is-invalid': submitted && f.totalToken.errors }" autocomplete="false"
                        (change)="onChangeToken()" class="form-control mb-2 mr-sm-2" />
                    <div *ngIf="submitted && f.totalToken.errors" class="invalid-feedback"></div>
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
                    <label for="dt1" class="mb-2 mr-sm-2">Expiry Date:</label>
                    <input id="dt1" formControlName="expiryDate"
                        [ngClass]="{ 'is-invalid': submitted && f.expiryDate.errors }" class="form-control mb-2 mr-sm-2"
                        [owlDateTimeTrigger]="dt1" [owlDateTime]="dt1" readonly>
                    <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
                    <div *ngIf="submitted && f.expiryDate.errors" class="invalid-feedback"></div>
                </div>
            </div>
            <div class="col-sm-4" style="padding: 0 0 0 0;">
                <div class="col-sm-6 pull-left" style="padding: 0 0 0 0px;">
                    <label for="supportEmail" class="mb-2 mr-sm-2">Support Email:</label>
                    <input type="text" id="supportEmail" formControlName="supportEmail" autocomplete="false"
                        class="form-control mb-2 mr-sm-2" />
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
                    <label for="supportPhNo" class="mb-2 mr-sm-2">Support Ph. No:</label>
                    <input type="text" id="supportPhNo" formControlName="supportPhNo" autocomplete="false"
                        class="form-control mb-2 mr-sm-2" />
                </div>
            </div>
            <div class="col-sm-4">
                <div class="col-sm-6 pull-left" style="padding: 0 0 0 0px;">
                    <label for="Street" class="mb-2 mr-sm-2">Street:</label>
                    <input type="text" id="Street" formControlName="Street" autocomplete="false"
                        class="form-control mb-2 mr-sm-2" />
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
                    <label for="rdo" class="mb-1 mr-sm-2">&nbsp;</label>
                    <div id="rdo">
                    <div class="custom-control custom-radio">
                        <input type="radio" class="custom-control-input" (click)="SetCustomerType('MainCustomer')"    id="customRadio1" name="rdoCom1" [checked]="iCheckMain">
                        <label class="custom-control-label" for="customRadio1">IsMainCustomer</label>
                      </div>
                      <div class="custom-control custom-radio">
                        <input type="radio" class="custom-control-input" (click)="SetCustomerType('SubCustomer')"   id="customRadio2" name="rdoCom1" [checked]="iCheckSub">
                        <label class="custom-control-label" for="customRadio2">IsSubCustomer</label>
                      </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6 pull-left" style="padding: 0 0 0 0px;">
                    <label for="MainCustomer" class="mb-2 mr-sm-2">Main Customer:</label>
                    <select name="MainCustomer" formControlName="MainCustomer"
                        class="custom-select"
                          id="MainCustomer">
                        <option selected value="0"></option>
                        <option *ngFor="let mcLst of MainCustomerList" [value]="mcLst.id">{{mcLst.customerName}}</option>
                    </select>
                    
                </div>
                <div class="col-sm-6 pull-right" style="padding: 0 0 0 5px;">
          <button class="ml-2 btn btn-primary col-sm-3 pull-right" (click)="Refresh()" type="button"
                        style="margin-top: 32px;">
                        <i class="fa fa-refresh fa-lg" aria-hidden="true"></i>
                    </button>
                    <button class="btn btn-primary col-sm-3 pull-right" style="margin-top: 32px;">
                        <i class="fa fa-floppy-o fa-lg" aria-hidden="true"></i>
                    </button>
                   
                </div>
            </div>
            <div class="col-sm-8">
                
                <div class="col-sm-3 pull-right" style="padding: 0 0 0 5px;">
                    <label for="cName" class="mb-2 mr-sm-2">&nbsp;</label>
                 <input type="text" id="cName" [(ngModel)]="searchText" [ngModelOptions]="{standalone: true}" autocomplete="off"
                placeholder="&#61442;  Search any text" class="form-control mb-2" />
       
            </div>
            </div>

        </div>
    </form>
    <div class="row">
        <div class="col-sm-12 m-0 p-0 mt-1">
           
             </div>
    </div>
        <div class="row">
            <div class="border col-sm-12 p-0">
        <div class="table-responsive">
            <table class="table table-sm table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th scope="col" style="width:150px !important;">Country Name</th>
                        <th scope="col" style="width:150px !important;">Customer Code</th>
                        <th scope="col">Customer Name</th>
                        <th scope="col">E-mail </th>
                        <th scope="col" style="width:120px !important;">Total Token </th>
                        <th scope="col" style="width:120px !important;">Expiry Date </th>
                        <th scope="col" class="Link-Center_Width"></th>
                        <th scope="col" class="Link-Center_Width"></th>
                        <th scope="col" style="width:100px !important;"></th>

                    </tr>
                </thead>
                <tbody>
                    <tr
                        *ngFor="let cLst of CustomerList | filter:searchText | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize ">
                        <td data-label="Country">
                            {{cLst.countryName}}
                        </td>
                        <td data-label="Customer Code">
                            {{cLst.customerCode}}
                        </td>
                        <td data-label="Name">
                            {{cLst.customerName}}
                        </td>
                        <td data-label="Email">
                            {{cLst.customerEmail}}
                        </td>
                        <td data-label="Total Token">
                            {{cLst.totalToken}}
                        </td>
                        <td data-label="Expiry Date">
                            {{cLst.expiryDate}}
                        </td>
                        <td data-label="" class="col-sm-1 cursor-pointer Link-Center_Width"
                            (click)="EditCustomer(cLst.id)">
                            <i class="fa fa-pencil-square-o text-primary" aria-hidden="true"></i>
                        </td>
                        <td data-label="" class="col-sm-1 cursor-pointer Link-Center_Width"
                            (click)="openCustomerDeleteModal(CustomerDeleteModal,cLst.id)">
                            <i class="fa fa-trash" style="color:red;" aria-hidden="true"></i>
                        </td>
                        <td data-label="" class="col-sm-1 cursor-pointer text-primary"
                        (click)="SendMail(cLst.id)">Send email
                    </td>
                    </tr>

                </tbody>

            </table>
            <ngb-pagination [collectionSize]="CustomerList.length" [(page)]="page" [pageSize]="pageSize"
                aria-label="Default pagination"></ngb-pagination>
        

    </div></div></div>
</div>



<ng-template #CustomerDeleteModal let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5>Delete Customer</h5>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body">
        <div class="container-fluid">
            <div class="row">
                <div class="col-sm-12">
                    <p>Are you sure to delete?</p>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <button class="btn btn-primary col-sm-2  pull-right" (click)="d('Cross click')">
                        <i class="fa fa-times fa-lg" aria-hidden="true"></i>
                    </button>
                    <button class="btn btn-danger col-sm-2  pull-right mr-2" (click)="DeleteCustomer()"
                        (click)="d('Cross click')">
                        <i class="fa fa-check fa-lg" aria-hidden="true"></i>
                    </button>

                </div>
            </div>

        </div>
    </div>

</ng-template>


<ng-template #modalCommon let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5>{{HeaderText}}</h5>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <div class="container-fluid">
  
        <div class="row">
          <div class="col-sm-12">
            <label for="State" class="mb-2 mr-sm-2">Name:</label>
            <input type="text" [(ngModel)]="NewName" class="form-control mb-2 mr-sm-2" id="fName">
          </div>
  
        </div>
        <div class="row">
          <div class="col-sm-12">
            <button class="btn btn-primary col-sm-2  pull-right" type="button" (click)="onSubmitModal()"
              (click)="d('Cross click')">
              <i class="fa fa-floppy-o fa-lg" aria-hidden="true"></i>
            </button>
          </div>
        </div>
  
      </div>
    </div>
  
  </ng-template>